{% extends "base/base_naked.html" %}

{% load staticfiles %}

{% block body %}

    <script src="{% static 'world/3rd/three.min.js' %}?{{ git_rev }}"></script>
    <script src="{% static 'world/3rd/OrbitControls.js' %}?{{ git_rev }}"></script>
    <script src="{% static 'world/base_renderer.js' %}?{{ git_rev }}"></script>
    <script src="{% static 'world/battle_renderer.js' %}?{{ git_rev }}"></script>

    <script>
        function info_callback(contubernium, contubernium_in_turn, unit, character, organization) {
            $('#unit_name').text(contubernium === undefined ? '' :
                unit.name + ' ' + contubernium_in_turn.soldiers.length +
                ' ' + contubernium_in_turn.attack_type +
                ' ' + (
                    contubernium_in_turn.attack_target !== null ?
                    map.units[map.contubernia[contubernium_in_turn.attack_target].unit_id].name :
                    ''
                )
                );
            $('#char_name').text(character === undefined ? '' : character.name);
            $('#org_name').text(organization === undefined ? '' : organization.name);
        }

        var map;
        $(function () {
            map = new BattleRenderer({{ battle_data|safe }});
            map.renderer.add_orbit_controls();
            map.hover_callback = info_callback;
        })
    </script>

    <div class="battlefield_turn_controls text-center">
        <button onclick="map.turn_back()" class="btn btn-default">
            <span class="glyphicon glyphicon-fast-backward" aria-hidden="true"></span>
        </button>
        <button onclick="map.step_back()" class="btn btn-default">
            <span class="glyphicon glyphicon-step-backward" aria-hidden="true"></span>
        </button>

        <span id="current_turn_display"></span>/<span id="total_turn_display"></span>

        <button onclick="map.step_fwd()" class="btn btn-default">
            <span class="glyphicon glyphicon-step-forward" aria-hidden="true"></span>
        </button>
        <button onclick="map.turn_fwd()" class="btn btn-default">
            <span class="glyphicon glyphicon-fast-forward" aria-hidden="true"></span>
        </button>
    </div>

    <div class="battlefield_unit_info text-right">
        <div id="org_name"></div>
        <div id="char_name"></div>
        <div id="unit_name"></div>
    </div>

{% endblock %}
